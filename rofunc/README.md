# Robotics Functions (RoFunc)

- [Robotics Functions (RoFunc)](#robotics-functions-rofunc)
  - [Hello, robot world!](#hello-robot-world)
  - [Available functions](#available-functions)
    - [Xsens](#xsens)
      - [Convert mvnx file to npys](#convert-mvnx-file-to-npys)
      - [Visualize the motion data](#visualize-the-motion-data)
    - [Optitrack](#optitrack)
      - [Get useful data](#get-useful-data)
      - [Visualize the motion data](#visualize-the-motion-data-1)

## Hello, robot world!

```python
import rofunc as rf
```

## Available functions

| Classes      | Types     | Functions             | Description                        | Status |
|--------------|-----------|-----------------------|------------------------------------|--------|
| **Devices**  | Xsens     | `xsens.process`       | Decoding the .mvnx file            | ✔️     |
|              |           | `xsens.visualize`     | Show or save gif about the motion  | ✔️     |
|              | Optitrack | `optitrack.process`   | Process the output .csv data       | ✔️     |
|              |           | `optitrack.visualize` | Show or save gif about the motion  |        |
|              | ZED       | `zed.record`          | Record with multiple cameras       |        |
|              |           | `zed.playback`        | Playback the recording             |        |
| **Planning** | LQT       | `lqt.uni`             | LQT for one agent                  |        |
|              |           | `lqt.bi`              | LQT for two agent with constraints |        |

### Xsens

#### Convert mvnx file to npys

`get_skeleton(mvnx_path, output_dir=None)`

```python
import rofunc as rf

mvnx_file = '/home/ubuntu/Data/06_24/Xsens/dough_01.mvnx'
rf.xsens.get_skeleton(mvnx_file) 
```

Then you will get a folder with multiple .npy files, each one refers to one segment.

> We also provide a batch form for converting mvnx files in parallel.

```python
import rofunc as rf

mvnx_dir = '../xsens_data'
rf.xsens.get_skeleton_batch(mvnx_dir)
```

#### Visualize the motion data

After obtains data of each segment, we can get a whole-body visualization
by `plot_skeleton(skeleton_data_path: str, save_gif=False)`

```python
import rofunc as rf

# dough_01 must be a folder with multiple .npy files about the skeleton which can be generated by `get_skeleton`
skeleton_data_path = './xsens_data/dough_01'
rf.xsens.plot_skeleton(skeleton_data_path)
```

![](../img/dough_01.gif)

> We also provide a batch form for saving gifs of several skeleton data in parallel.

```python
import rofunc as rf

# There must contain a folder with multiple .npy files about the skeleton which can be generated by `get_skeleton`
skeleton_dir = './xsens_data/'
rf.xsens.plot_skeleton_batch(skeleton_dir)
```

### Optitrack

#### Get useful data

You need first prepare your raw data in the following structure.

```
├── dough_01
│   ├── Take 2022-06-24 07.40.52 PM.csv
│   ├── Take 2022-06-24 07.40.52 PM_ManusVRGlove_3f6ec26f_3f6ec26f.csv (if applicable)
│   └── Take 2022-06-24 07.40.52 PM_ManusVRGlove_7b28f20b_7b28f20b.csv (if applicable)
├── dough_02
│   ├── Take 2022-06-24 07.44.15 PM.csv
│   ├── Take 2022-06-24 07.44.15 PM_ManusVRGlove_3f6ec26f_3f6ec26f.csv (if applicable)
│   └── Take 2022-06-24 07.44.15 PM_ManusVRGlove_7b28f20b_7b28f20b.csv (if applicable)
├── dough_03
...
```

You can get the useful data by `data_clean(input_path)`

```python
import rofunc as rf

root_path = '/home/ubuntu/Github/DGform/data/opti_data/dough_01'
rf.optitrack.data_clean(root_path)
```

Then you will obtain new csv files in the same directory.

```
├── dough_01
│   ├── left_manus.csv
│   ├── opti_hands.csv
│   ├── process
│   │   ├── Take 2022-06-24 07.40.52 PM_ManusVRGlove_3f6ec26f_3f6ec26f.csv
│   │   └── Take 2022-06-24 07.40.52 PM_ManusVRGlove_7b28f20b_7b28f20b.csv
│   ├── right_manus.csv
│   ├── Take 2022-06-24 07.40.52 PM.csv
│   ├── Take 2022-06-24 07.40.52 PM_ManusVRGlove_3f6ec26f_3f6ec26f.csv
│   └── Take 2022-06-24 07.40.52 PM_ManusVRGlove_7b28f20b_7b28f20b.csv
├── dough_02
│   ├── left_manus.csv
│   ├── opti_hands.csv
│   ├── process
│   │   ├── Take 2022-06-24 07.44.15 PM_ManusVRGlove_3f6ec26f_3f6ec26f.csv
│   │   └── Take 2022-06-24 07.44.15 PM_ManusVRGlove_7b28f20b_7b28f20b.csv
│   ├── right_manus.csv
│   ├── Take 2022-06-24 07.44.15 PM.csv
│   ├── Take 2022-06-24 07.44.15 PM_ManusVRGlove_3f6ec26f_3f6ec26f.csv
│   └── Take 2022-06-24 07.44.15 PM_ManusVRGlove_7b28f20b_7b28f20b.csv
├── dough_03
...
```

> We also provide a batch form cleaning several data in parallel.

```python 
import rofunc as rf

input_dir = '/home/ubuntu/Github/DGform/data/opti_data/'
rf.optitrack.process.data_clean_batch(input_dir)
```

#### Visualize the motion data
